metadata:
- description: "\n            XML Rules for Camel endpoints that have had one or more
    options removed\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-java,3.0.0.Final
  sourceTechnology:
  - id: camel
    versionRange: '[2,3)'
  targetTechnology:
  - id: camel
    versionRange: '[3,)'
rules:
  rule:
  - when:
      or:
      - javaclass:
        - location:
          - METHOD_CALL
          references: org.apache.camel.component.kafka.KafkaConfiguration.{method}({*})
        xmlfile:
        - namespace:
          - value: ""
            prefix: c
            uri: http://camel.apache.org/schema/spring
          matches: //*/c:to/@uri[windup:matches(self::node(), 'kafka:{*}{options}{*}')]
        - namespace:
          - value: ""
            prefix: c
            uri: http://camel.apache.org/schema/blueprint
          matches: //*/c:to/@uri[windup:matches(self::node(), 'kafka:{*}{options}{*}')]
        filecontent:
        - pattern: .to("kafka:{[^"]+}{options}={*}
          filename: '{*}.java'
    perform:
      hint:
      - message: The `org.apache.camel:camel-kafka` component has removed the options
          `bridgeEndpoint` and `circularEndpointDetection` as they are no longer needed
          because the component is acting as bridging would work on Camel 2.x. In
          other words camel-kafka will send messages to the topic from the endpoint
          uri. To override this use the KafkaConstants.OVERRIDE_TOPIC header with
          the new topic. See more details in the camel-kafka component documentation.
        link:
        - value: ""
          title: 'Camel 3 - Migration Guide: Kafka'
          href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_kafka
        title: The `org.apache.camel:camel-kafka` component has removed the options
          `bridgeEndpoint` and `circularEndpointDetection`
        category-id: mandatory
        effort: 3
    where:
    - matches:
      - value: ""
        pattern: (circularTopicDetection|bridgeEndpoint)
      param: options
    - matches:
      - value: ""
        pattern: (setBridgeEndpoint|setCircularTopicDetection)
      param: method
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/camel3/camel2/component-changes.windup.xml
