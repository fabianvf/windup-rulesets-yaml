metadata:
- description: "\n            Rules for changes in XML file (e.g. pom.xml) to run
    on Apache Camel 3\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-java,3.0.0.Final
  sourceTechnology:
  - id: camel
    versionRange: '[2,3)'
  targetTechnology:
  - id: camel
    versionRange: '[3,)'
rules:
  rule:
  - when:
      javaclass:
      - location:
        - IMPORT
        references: org.apache.camel.util.component.{*}
        as: javaClass
    perform:
      iteration:
      - hint:
        - message: "All the classes from `org.apache.camel.util.component` have been
            moved to `org.apache.camel.support.component`.\n                            `org.apache.camel:camel-support`
            is a transitive dependency of `camel-core` but it could be used also separately
            to trim the application size.\n                        "
          link:
          - value: ""
            title: Camel 3 - Migration Guide
            href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_modularization_of_camel_core
          - value: ""
            title: 'Camel 3 - Migration Guide: Modularization of camel-core'
            href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_modularization_of_camel_core
          title: The classes from `org.apache.camel.util.component` have been moved
          category-id: mandatory
          effort: 1
        over: javaClass
  - when:
      javaclass:
      - location:
        - IMPORT
        references: org.apache.camel.impl.{moved}
        as: javaClass
    perform:
      iteration:
      - hint:
        - message: "The class `org.apache.camel.impl.{moved}` has been moved to `org.apache.camel.impl.engine`
            package in `camel-base` dependency.\n                            `org.apache.camel:camel-base`
            is a transitive dependency of `camel-core` but it could be used also separately
            to trim the application size.\n                        "
          link:
          - value: ""
            title: 'Camel 3 - Migration Guide: General information'
            href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_generic_information
          - value: ""
            title: 'Camel 3 - Migration Guide: Modularization of camel-core'
            href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_modularization_of_camel_core
          title: '`org.apache.camel.impl.{moved}` class has been moved'
          category-id: mandatory
          effort: 1
        over: javaClass
    where:
    - matches:
      - value: ""
        pattern: (CamelPostProcessorHelper|DefaultAsyncProcessorAwaitManager|DefaultCamelBeanPostProcessor|DefaultCamelContextNameStrategy|DefaultClaimCheckRepository|DefaultClassResolver|DefaultComponentResolver|DefaultConsumerTemplate|DefaultDataFormatResolver|DefaultEndpointRegistry|DefaultEndpointUtilizationStatistics|DefaultFactoryFinder|DefaultFactoryFinderResolver|DefaultHeadersMapFactory|DefaultInflightRepository|DefaultInjector|DefaultLanguageResolver|DefaultManagementNameStrategy|DefaultMessageHistoryFactory|DefaultNodeIdFactory|DefaultPackageScanClassResolver|DefaultProcessorFactory|DefaultProducerTemplate|DefaultRoute|DefaultRouteContext|DefaultRouteController|DefaultRouteError|DefaultRouteStartupOrder|DefaultRuntimeEndpointRegistry|DefaultShutdownStrategy|DefaultStreamCachingStrategy|DefaultTransformerRegistry|DefaultUnitOfWork|DefaultUnitOfWorkFactory|DefaultUuidGenerator|DefaultValidatorRegistry|DeferProducer|DeferServiceStartupListener|DurationRoutePolicy|DurationRoutePolicyFactory|EndpointKey|EventDrivenConsumerRoute|EventNotifierCallback|ExplicitCamelContextNameStrategy|FileStateRepository|HashMapHeadersMapFactory|HeadersMapFactoryResolver|InterceptSendToEndpointProcessor|InterceptSendToMockEndpointStrategy|JavaUuidGenerator|LimitedPollingConsumerPollStrategy|MDCUnitOfWork|MemoryStateRepository|SubscribeMethodProcessor|SupervisingRouteController|SupervisingRouteController.FilterResult|SupervisingRouteControllerFilters|SupervisingRouteControllerFilters.BlackList|TypedProcessorFactory|WebSpherePackageScanClassResolver)
      param: moved
  - when:
      javaclass:
      - location:
        - IMPORT
        references: org.apache.camel.main.Main
        as: javaClass
    perform:
      iteration:
      - when:
          not:
          - project:
            - artifact:
                value: ""
                groupId: org.apache.camel
                artifactId: camel-main
        perform:
          hint:
          - message: "The class `org.apache.camel.main.Main` has been moved out of
              `org.apache.camel:camel-core` and into its own JAR named `org.apache.camel:camel-main`.\n
              \                               `org.apache.camel:camel-main` has to
              be added as a dependency to your project pom.xml file\n                            "
            link:
            - value: ""
              title: Camel 3 - Main class
              href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_main_class
            title: '`org.apache.camel.main.Main` class has been moved'
            category-id: mandatory
            effort: 1
        over: javaClass
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: m
          uri: http://maven.apache.org/POM/4.0.0
        as: dependencies-block
        matches: /m:project/m:dependencies[count(m:dependency/m:artifactId[text()='camel-management'])=0
          and count(m:dependency/m:artifactId[text()='camel-core'])>0]
        in: pom.xml
    perform:
      iteration:
      - hint:
        - message: "If you run Camel standalone with just `camel-core` as a dependency,
            and you want JMX enabled out of the box, then you need to add `org.apache.camel:camel-management`
            as a dependency.\n                        "
          link:
          - value: ""
            title: Camel 3 - JMX
            href: https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_jmx
          title: JMX is disable by default
          category-id: potential
          effort: 1
        over: dependencies-block
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/camel3/camel2/xml-moved-components.windup.xml
