metadata:
- description: "\n            This ruleset provides analysis in both JBoss EAP 4 and
    5\n            that may require individual attention when migrating to JBoss EAP
    6 and 7.\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-javaee,3.0.0.Final
    - id: org.jboss.windup.rules,windup-rules-java,3.0.0.Final
  sourceTechnology:
  - id: eap
    versionRange: '[4,6)'
  targetTechnology:
  - id: eap
    versionRange: '[6,8)'
rules:
  rule:
  - when:
      file:
      - filename: jboss-{types}.xml
    perform:
      hint:
      - message: "\n                        \n                        MBeans were
          part of the core architecture in previous versions of Red Hat JBoss Enterprise
          Application Platform.  \n                        JBoss Service Archive (SAR)
          deployments using the JBoss specific `jboss-service.xml` and `jboss-beans.xml`
          service-style descriptors were used by the application server to create
          MBeans based on JBoss Beans.  \n                        The internal architecture
          has changed in JBoss EAP 6+ and is no longer based on an MBean JMX architecture.\n
          \                       \n                    "
        link:
        - value: ""
          title: JBoss EAP 6 - Migration Guide
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/migration_guide/#sect-Service-style_Deployment_Changes
        - value: ""
          title: How to change a jboss-service.xml / sar MBean Singleton to a Java
            EE 6 Singleton in JBoss EAP 6
          href: https://access.redhat.com/solutions/416333
        - value: ""
          title: Are service archives (sar), jboss-service.xml, JBoss MBeans, jboss-beans.xml
            recommended in JBoss EAP 6?
          href: https://access.redhat.com/solutions/374333
        - value: ""
          title: jboss:service=Naming in JBoss EAP 6
          href: https://access.redhat.com/solutions/1212103
        title: Replace service-style deployments
        category-id: optional
        issue-display-mode: all
        effort: 1
    where:
    - matches:
      - value: ""
        pattern: (service|beans)
      param: types
  - when:
      xmlfile:
      - matches: //mbean[@code='org.jboss.system.BarrierController']
        in: jboss-service.xml
    perform:
      hint:
      - message: "\n                        \n                        `BarrierController`
          service is no longer available in JBoss EAP 6+.  \n                         In
          JBoss EAP 4.x the JBoss 'kernel' layer was an extension of JMX which is
          why everything was an MBean, though most of the MBean functionality still
          worked in JBoss EAP 5.  \n                         JBoss EAP 6 is no longer
          based on Mbeans, and the Mbeans which are seen in jconsole are actually
          just facades over the JBoss management API, so declaring Mbean dependencies
          on any other Mbeans that appear to be JBoss Mbeans does not work since they
          are not real Mbeans.  \n                        \n                    "
        link:
        - value: ""
          title: 'BarrierController service in JBoss EAP 6 '
          href: https://access.redhat.com/solutions/410953
        - value: ""
          title: JBoss EAP 6 - Migration Guide
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/migration_guide/#Review_The_List_of_Deprecated_and_Unsupported_Features
        - value: ""
          title: JBoss EAP 5 - HASingleton Deployment Options
          href: https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/5/html-single/administration_and_configuration_guide/index#idm139776751035360
        title: Replace BarrierController service
        category-id: mandatory
        issue-display-mode: all
        effort: 1
  - when:
      or:
      - xmlfile:
        - matches: //mbean[@code='org.jboss.remoting.transport.Connector']//attribute[text()='org.jboss.remoting.marshal.compress.CompressingMarshaller'
            and @name='marshaller']
          in: jboss-service.xml
        - matches: //value[text()='org.jboss.remoting.marshal.compress.CompressingMarshaller']
          in: jboss-beans.xml
    perform:
      hint:
      - message: "\n                        \n                        `CompressingMarshaller`
          marshaller is no longer available in JBoss EAP 6+.  \n                        In
          JBoss EAP 6.3.0 and later, data compression hints can be specified via the
          JBoss annotation `org.jboss.ejb.client.annotation.CompressionHint`\n                        \n
          \                   "
        link:
        - value: ""
          title: How to compress remote EJB communication in JBoss EAP 6
          href: https://access.redhat.com/solutions/322953
        title: Replace CompressingMarshaller marshaller
        category-id: mandatory
        issue-display-mode: all
        effort: 1
  - when:
      xmlfile:
      - matches: //authentication/login-module
    perform:
      hint:
      - message: "\n                        \n                        In JBoss EAP
          6+, Security is configured in the `<security-domain>` element in the server
          configuration file.\n                        \n                    "
        link:
        - value: ""
          title: Configure UsersRolesLoginModule for EAP 6 management console
          href: https://access.redhat.com/solutions/219933
        - value: ""
          title: JBoss EAP 6 - Migration Guide
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/migration_guide/#sect-Configuration_File_Changes
        title: Replace Login Module definition
        category-id: mandatory
        issue-display-mode: all
        effort: 5
  - when:
      xmlfile:
      - matches: //class-loading/loader-repository
        in: jboss{type}.xml
    perform:
      hint:
      - message: "\n                        \n                        The `class-loading`
          and `loader-repository` configuration in `jboss.xml`, `jboss-web.xml` and
          `jboss-service.xml` were JBoss EAP 4.x & 5.x configuration options for specifying
          classloader isolation on a deployment.  \n                        In JBoss
          EAP 6+, it uses JBoss Modules for its classloader implementation so all
          deployments are isolated in their own classloader / JBoss Module and the
          `loader-repository` is no longer valid.  \n                        The `jboss-deployment-structure.xml`
          can be used to specify classloader / module dependencies if needed.\n                        \n
          \                   "
        link:
        - value: ""
          title: JBoss EAP 6 - Migration Guide
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/migration_guide/#sect-Configuration_File_Changes
        - value: ""
          title: Unexpected element 'class-loading' in jboss-web.xml when migrating
            to JBoss EAP 6
          href: https://access.redhat.com/solutions/1162713
        - value: ""
          title: JBoss EAP 6 - jboss-deployment-structure.xml
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/development_guide/#jboss-deployment-structurexml
        - value: ""
          title: JBoss EAP 7 - jboss-deployment-structure.xml
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/development_guide/#jboss_deployment_structure_xml
        title: Remove class-loading definition
        category-id: mandatory
        issue-display-mode: all
        effort: 3
    where:
    - matches:
      - value: ""
        pattern: (-web|-service)?
      param: type
  - when:
      xmlfile:
      - matches: //mbean[@code='org.jboss.naming.NamingAlias']
        in: jboss-service.xml
    perform:
      iteration:
      - hint:
        - message: "\n                        \n                        JBoss EAP
            6 supports deploying SAR files, however JBoss EAP 5 and 6 do not share
            a lot of the internals.  \n                        The class your `jboss-{types}.xml`
            file is trying to instantiate (`org.jboss.naming.NamingAlias`) was an
            implementation detail of JBoss EAP 5's naming components that does not
            exist in JBoss EAP 6.\n                        \n                    "
          link:
          - value: ""
            title: JBoss EAP 5 - The org.jboss.naming.NamingAlias MBean
            href: https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/5/html-single/administration_and_configuration_guide/#Additional_Naming_MBeans-The_org.jboss.naming.NamingAlias_MBean
          - value: ""
            title: NamingAlias ClassNotFoundException when migrating SAR to JBoss
              EAP 6
            href: https://access.redhat.com/solutions/314303
          title: Create org.jboss.naming.NamingAlias class
          category-id: mandatory
          issue-display-mode: all
          effort: 1
  - when:
      xmlfile:
      - matches: //mbean[@code='org.jboss.security.plugins.JaasSecurityManagerService']/attribute[@name='DefaultCacheTimeout']
        in: jboss-service.xml
    perform:
      hint:
      - message: "\n                        \n                        In JBoss EAP
          6 and 7 you can set the JAAS cache timeout, changing the `cache-type` to
          `infinispan` which uses Infinispan cache which has an expiration capability.\n
          \                       \n                    "
        link:
        - value: ""
          title: JBoss EAP 5 - Custom Callback Handlers
          href: https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/5/html-single/security_guide/#Custom_Callback_Handlers
        - value: ""
          title: How to set authentication cache timeout in JBoss EAP6/7
          href: https://access.redhat.com/solutions/259693
        title: 'Set authentication cache timeout '
        category-id: mandatory
        issue-display-mode: all
        effort: 1
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/eap7/eap4and5/jboss-eap4and5to6and7-xml.windup.xml
