metadata:
- description: "\n            This ruleset provides analysis in both JBoss EAP 5 and
    JBoss EAP 6\n            that may require individual attention when migrating
    to JBoss EAP 7+.\n            The purpose of this ruleset common to those two
    major JBoss EAP versions is to avoid duplication of rules\n            in rulesets
    dedicated to either version.\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-javaee,2.6.0.Final
    - id: org.jboss.windup.rules,windup-rules-java,2.6.0.Final
  sourceTechnology:
  - id: eap
    versionRange: '[5,7)'
  targetTechnology:
  - id: eap
    versionRange: '[7,)'
  tag:
  - jboss-eap5
  - jboss-eap6
rules:
  rule:
  - when:
      filecontent:
      - pattern: 'Dependencies:'
        filename: MANIFEST.MF
    perform:
      iteration:
      - classification:
        - description:
          - Verify in advance that all the modules this application depends on still
            exist.
          link:
          - value: ""
            title: EAP 7 Implicit Module Dependencies
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html/development_guide/class_loading_and_modules#implicit_module_dependencies
          - value: ""
            title: EAP 7 Included Modules
            href: https://access.redhat.com/articles/2158031
          tag:
          - configuration
          title: Dependency entries in MANIFEST.MF
          effort: 1
          category-id: mandatory
          issue-display-mode: all
  - when:
      file:
      - filename: jbossws-cxf.xml
    perform:
      iteration:
      - classification:
        - description:
          - Migrate all functionality specified in such XML descriptor. It is mostly
            already supported by the JAX-WS specification, included in Java EE 7.
            For specific functionality consult the Apache CFX documentation link provided.
          link:
          - value: ""
            title: Apache CXF Spring Web Services Changes
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_apache_cxf_spring_web_services_changes
          tag:
          - webservices
          - jbossws
          - cxf
          - configuration
          title: 'Apache CFX integration with JBoss '
          effort: 3
          category-id: mandatory
          issue-display-mode: all
  - when:
      javaclass:
      - location:
        - IMPLEMENTS_TYPE
        - INHERITANCE
        references: javax.ejb.EntityBean
    perform:
      iteration:
      - hint:
        - message: |-
            Entity beans are no longer supported in JBoss EAP 7. User is requested to use JPA entities that fully replaced the functionality provided by Entity beans.
                                    This entity needs to be migrated using JPA persistence.xml or using JPA annotations.
          link:
          - value: ""
            title: Migrate Entity Beans to JPA
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_entity_beans_to_jpa
          tag:
          - cmp
          - jpa
          title: Entity EJB
          category-id: mandatory
          effort: 5
  - when:
      or:
      - javaclass:
        - location:
          - IMPLEMENTS_TYPE
          references: org.apache.catalina.Valve
        - location:
          - INHERITANCE
          references: org.apache.catalina.valves.ValveBase
    perform:
      iteration:
      - classification:
        - description:
          - JBoss Web was replaced by Undertow, which does not contain support for
            the Valve functionality. It may be needed to migrate to Undertow handlers.
          link:
          - value: ""
            title: Migrate JBoss Web Valves
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_jboss_web_valves
          tag:
          - web
          - undertow
          title: JBoss Web Valve
          effort: 3
          category-id: mandatory
          issue-display-mode: all
  - when:
      or:
      - javaclass:
        - location:
          - IMPORT
          references: javax.enterprise.deploy{*}
    perform:
      iteration:
      - hint:
        - message: This class is using JSR 88 specific classes. Rely instead on proprietary
            functionality to automate deployments. Please consult EAP 7 admin documentation
            to learn about such functionality
          link:
          - value: ""
            title: Migrate Deployment Plan Configurations
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_deployment_plan_configurations
          tag:
          - configuration
          - undertow
          title: JSR 88 deployment plan not supported
          category-id: mandatory
          effort: 1
  - when:
      javaclass:
      - location:
        - IMPORT
        references: org.jboss.as.clustering.singleton.SingletonService
    perform:
      iteration:
      - hint:
        - message: EAP 7 includes a new API for building Singleton services, which
            significantly simplifies the process, and solves the issues found in the
            legacy solution.
          link:
          - value: ""
            title: Migration of HA Singleton
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_clustering_ha_singleton
          tag:
          - singleton
          title: Outdated HA Singleton
          category-id: mandatory
          effort: 1
  - when:
      javaclass:
      - location:
        - ANNOTATION
        - IMPORT
        references: org.jboss.ejb3.annotation.Clustered
    perform:
      hint:
      - message: "\n                        The `@Clustered` annotation is ignored
          in EAP 7 and is not useful. In case the application is started using HA
          profile, the replication will be done automatically.\n                    "
        link:
        - value: ""
          title: Stateful Session EJB Clustering Changes
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_stateful_session_ejb_clustering_changes
        tag:
        - cluster
        - ejb
        quickfix:
        - search: '@Clustered'
          type: DELETE_LINE
          name: Clustered
        - search: org.jboss.ejb3.annotation.Clustered
          type: DELETE_LINE
          name: ClusteredImport
        title: Stateful Session EJB Clustering changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      javaclass:
      - references: org.hornetq.{*}
    perform:
      classification:
      - description:
        - HornetQ was replaced by ActiveMQ Artemis in EAP 7. You should replace all
          references to `org.hornetq.*` with JMS API or ActiveMQ Artemis API.
        link:
        - value: ""
          title: What's new in JBoss EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#whats_new_in_eap
        - value: ""
          title: ActiveMQ Artemis Migration
          href: https://activemq.apache.org/artemis/migration.html
        tag:
        - hornetq
        - jms
        title: HornetQ was removed in EAP 7
        effort: 1
        category-id: mandatory
        issue-display-mode: all
  - when:
      javaclass:
      - location:
        - ANNOTATION
        references: org.jboss.logging.{annotation}
    perform:
      hint:
      - message: 'JBoss Logging annotations in package `org.jboss.logging` are deprecated.
          You should replace them by the corresponding annotations from package `org.jboss.logging.annotations`.
          Note that using the `org.jboss.logging.annotations` package requires adding
          a new dependency: `org.jboss.logging:jboss-logging-annotations`.'
        link:
        - value: ""
          title: JBoss Logging Changes
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_jboss_logging_changes
        tag:
        - logging
        title: JBoss deprecated logging annotations
        category-id: mandatory
        effort: 1
    where:
    - matches:
      - value: ""
        pattern: (Cause|Field|FormatWith|LoggingClass|LogMessage|Message|MessageBundle|MessageLogger|Param|Property)
      param: annotation
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/eap7/eap5and6/jboss-eap5and6to7-java.windup.xml
