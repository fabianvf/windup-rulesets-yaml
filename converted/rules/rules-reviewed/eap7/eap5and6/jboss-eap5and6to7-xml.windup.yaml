metadata:
- description: "\n            This ruleset provides analysis of configuration XML
    files in both JBoss EAP 5 and JBoss EAP 6\n            that may require individual
    attention when migrating to JBoss EAP 7+.\n            The purpose of this ruleset
    common to those two major JBoss EAP versions is to avoid duplication of rules\n
    \           in rulesets dedicated to either version.\n            Mainly deals
    with datasources, JBoss Web and EJB configuration.\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-javaee,2.6.0.Final
    - id: org.jboss.windup.rules,windup-rules-java,2.6.0.Final
  sourceTechnology:
  - id: eap
    versionRange: '[5,7)'
  targetTechnology:
  - id: eap
    versionRange: '[7,)'
  tag:
  - jboss-eap5
  - jboss-eap6
  - ejb
rules:
  rule:
  - when:
      xmlfile:
      - matches: /*[local-name()='ejb-jar']/*[local-name()='assembly-descriptor']/*[local-name()='clustering']/*[local-name()='clustered']
        in: jboss-ejb3.xml
    perform:
      iteration:
      - hint:
        - message: "\n                        The `clustered` element is ignored in
            EAP 7 and is not useful. In case the application is started using HA profile,
            the replication will be done automatically.\n                    "
          link:
          - value: ""
            title: Clustered annotation in EAP 7
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_stateful_session_ejb_clustering_changes
          tag:
          - cluster
          - ejb
          - configuration
          title: Stateful Session EJB Clustering configuration changes in EAP 7
          category-id: optional
          effort: 1
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: sc
          uri: http://jboss.com/products/seam/components
        matches: /sc:components
    perform:
      classification:
      - description:
        - You should migrate from Seam 2 Framework to Context Dependency Injection
          technology.
        link:
        - value: ""
          title: Context and dependency injection - CDI
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/development_guide/#contexts_and_dependency_injection_cdi
        - value: ""
          title: Migration from Seam 2 to Java EE and alternatives
          href: https://access.redhat.com/documentation/en-us/Red_Hat_JBoss_Web_Framework_Kit/2.7/html/Seam_Guide/ch36.html
        tag:
        - seam2
        - jboss-eap5
        title: JBoss Seam Components (components.xml)
        effort: 5
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: sp
          uri: http://jboss.com/products/seam/pages
        matches: /sp:pages
    perform:
      classification:
      - description:
        - "You should migrate from Seam 2 Framework to Context Dependency Injection
          technology.\n                        The most features from `pages.xml`
          file where it is specified a page flow and other configuration of the Seam
          Framework is achievable through JSF Flow.\n                    "
        link:
        - value: ""
          title: Seam 2 Framework Reference
          href: https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/5/html-single/seam_reference_guide/
        - value: ""
          title: Using Faces Flows
          href: https://docs.oracle.com/javaee/7/tutorial/jsf-configure003.htm
        tag:
        - seam
        - jboss-eap5
        title: JBoss Seam Pages (pages.xml)
        effort: 5
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: /page
        in: '{*}.page.xml'
    perform:
      classification:
      - tag:
        - seam
        - jboss-eap5
        title: JBoss Seam Page
        effort: 3
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: //*[local-name()='jboss-web']
        in: jboss-web.xml
    perform:
      classification:
      - description:
        - "\n                        The `jboss-web.xml` file configures a Java EE
          web application specifically for JBoss EAP.\n                        It
          is an extension to standard `web.xml`.\n                    "
        link:
        - value: ""
          title: jboss-web.xml Configuration Reference
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/development_guide/#jboss-webxml_Configuration_Reference
        tag:
        - web
        - configuration
        - deployment
        - descriptor
        - jboss-eap5
        title: JBoss web application descriptor (jboss-web.xml)
        effort: 1
        issue-display-mode: detail-only
  - when:
      xmlfile:
      - matches: //*[local-name()='jbosscmp-jdbc']
        in: jbosscmp-jdbc.xml
    perform:
      classification:
      - description:
        - "\n                        The `jbosscmp-jdbc.xml` is a deployment decriptor
          controlling the Container Managed Persistence (CMP).\n\n                        Support
          for EJB Entity Beans is optional in Java EE 7 and they are not supported
          in JBoss EAP 7.\n                        This means CMP entity beans must
          be rewritten to use Java Persistence API (JPA) entities.\n                    "
        link:
        - value: ""
          title: Migrate Entity Beans to JPA
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_entity_beans_to_jpa
        - value: ""
          title: JBoss EAP 5 - The jbosscmp-jdbc Structure
          href: https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform/5/html-single/administration_and_configuration_guide/index#The_CMP_Engine-The_jbosscmp_jdbc_Structure
        tag:
        - jdbc
        - ejb2
        - jboss-eap5
        - jpa
        title: JBoss EJB 2 CMP Deployment descriptor (jbosscmp-jdbc.xml)
        effort: 5
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: //*[local-name()='ejb-jar']
        in: jboss-ejb3.xml
    perform:
      classification:
      - description:
        - "\n                        A JBoss specific EJB 3 configuration allows extensions
          of Java EE EJB 3.\n                    "
        link:
        - value: ""
          title: jboss-ejb3.xml Deployment Descriptor Reference
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/development_guide/index#jboss-ejb3xml_Deployment_Descriptor_Reference
        tag:
        - jboss-eap5
        title: JBoss EJB 3 deployment descriptor (jboss-ejb3.xml)
        effort: 5
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: //*[local-name()='webservices']
        in: jboss-webservices.xml
    perform:
      classification:
      - description:
        - "\n                        JBossWS 4.0 introduces a new deployment descriptor
          to configure web services.\n                        The `jboss-webservices.xml`
          file provides additional information for the given deployment\n                        and
          partially replaces the obsolete `jboss.xml` file.\n\n                        For
          EJB webservice deployments, the expected location of the `jboss-webservices.xml`
          descriptor file\n                        is in the `META-INF/` directory.
          For POJO and EJB webservice endpoints bundled in WAR file,\n                        the
          expected location of the `jboss-webservices.xml` file is in the `WEB-INF/`
          directory.\n                    "
        link:
        - value: ""
          title: JBoss web-services changes
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_service_application_changes
        tag:
        - jboss-ws
        - descriptor
        - webservice
        - jboss-eap5
        title: JBoss web-services deployment descriptor (jboss-webservices.xml)
        effort: 5
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: j2e
          uri: http://java.sun.com/xml/ns/j2ee
        - value: ""
          prefix: jee
          uri: http://java.sun.com/xml/ns/javaee
        - value: ""
          prefix: jcp
          uri: http://xmlns.jcp.org/xml/ns/javaee
        matches: /ejb-jar/enterprise-beans/entity[persistence-type = 'Container']
          | /jee:ejb-jar/jee:enterprise-beans/jee:entity[jee:persistence-type = 'Container']
          | /j2e:ejb-jar/j2e:enterprise-beans/j2e:entity[j2e:persistence-type = 'Container']
          | /jcp:ejb-jar/jcp:enterprise-beans/jcp:entity[jcp:persistence-type = 'Container']
        in: ejb-jar.xml
    perform:
      iteration:
      - hint:
        - message: |-
            CMP entity beans are no longer supported in JBoss EAP 7. User is requested to use JPA entities that fully replaced the functionality provided by CMP beans.
                                CMP configuration provided in this ejb-jar.xml should be configured using JPA persistence.xml or using JPA annotations.
          link:
          - value: ""
            title: CMP Bean migration
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_entity_beans_to_jpa
          tag:
          - jpa
          - cmp
          title: CMP Entity EJB configuration
          category-id: mandatory
          effort: 3
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: j2e
          uri: http://java.sun.com/xml/ns/j2ee
        - value: ""
          prefix: jee
          uri: http://java.sun.com/xml/ns/javaee
        - value: ""
          prefix: jcp
          uri: http://xmlns.jcp.org/xml/ns/javaee
        matches: /ejb-jar/enterprise-beans/entity[persistence-type = 'Bean'] | /jee:ejb-jar/jee:enterprise-beans/jee:entity[jee:persistence-type
          = 'Bean'] | /j2e:ejb-jar/j2e:enterprise-beans/j2e:entity[j2e:persistence-type
          = 'Bean'] | /jcp:ejb-jar/jcp:enterprise-beans/jcp:entity[jcp:persistence-type
          = 'Bean']
        in: ejb-jar.xml
    perform:
      iteration:
      - hint:
        - message: |-
            BMP entity beans are no longer supported in JBoss EAP 7. User is requested to use JPA entities that fully replaced the functionality provided by BMP beans.
                               BMP configuration provided in this ejb-jar.xml should be configured using JPA persistence.xml or using JPA annotations.
          link:
          - value: ""
            title: CMP Bean migration
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_entity_beans_to_jpa
          tag:
          - jpa
          - bmp
          title: EJB 2.x BMP Entity Beans configuration
          category-id: mandatory
          effort: 3
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: jboss
          uri: http://www.jboss.com/xml/ns/javaee
        matches: /jboss-web/valve | /jboss:jboss-web/jboss:valve
        in: jboss-web.xml
    perform:
      iteration:
      - hint:
        - message: JBoss Web was replaced by Undertow, which does not contain support
            for the Valve functionality. It may be needed to migrate to Undertow handlers.
          link:
          - value: ""
            title: Valve migration
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_custom_application_valves
          tag:
          - web
          title: Valve is not supported in JBoss EAP 7
          category-id: mandatory
          effort: 1
  - when:
      or:
      - xmlfile:
        - namespace:
          - value: ""
            prefix: j2ee
            uri: http://java.sun.com/xml/ns/j2ee
          - value: ""
            prefix: jcp
            uri: http://xmlns.jcp.org/xml/ns/javaee
          - value: ""
            prefix: jee
            uri: http://java.sun.com/xml/ns/javaee
          matches: /webservices/webservice-description/jaxrpc-mapping-file | /jee:webservices/jee:webservice-description/jee:jaxrpc-mapping-file
            | /jcp:webservices/jcp:webservice-description/jcp:jaxrpc-mapping-file
            | /j2ee:webservices/j2ee:webservice-description/j2ee:jaxrpc-mapping-file
        - namespace:
          - value: ""
            prefix: j2ee
            uri: http://java.sun.com/xml/ns/j2ee
          - value: ""
            prefix: jcp
            uri: http://xmlns.jcp.org/xml/ns/javaee
          - value: ""
            prefix: jee
            uri: http://java.sun.com/xml/ns/javaee
          matches: /ejb-jar/enterprise-beans/session/service-ref/jaxrpc-mapping-file
            | /jee:ejb-jar/jee:enterprise-beans/jee:session/jee:service-ref/jee:jaxrpc-mapping-file
            | /jcp:ejb-jar/jcp:enterprise-beans/jcp:session/jcp:service-ref/jcp:jaxrpc-mapping-file
            | /j2ee:ejb-jar/j2ee:enterprise-beans/j2ee:session/j2ee:service-ref/j2ee:jaxrpc-mapping-file
        - namespace:
          - value: ""
            prefix: j2ee
            uri: http://java.sun.com/xml/ns/j2ee
          - value: ""
            prefix: jcp
            uri: http://xmlns.jcp.org/xml/ns/javaee
          - value: ""
            prefix: jee
            uri: http://java.sun.com/xml/ns/javaee
          matches: /java-wsdl-mapping | /jee:java-wsdl-mapping | /jcp:java-wsdl-mapping
            | /j2ee:java-wsdl-mapping
    perform:
      iteration:
      - hint:
        - message: JAX-RPC support was removed in JBoss EAP 7. All the RPC calls will
            need to be migrated to JAX-WS.
          link:
          - value: ""
            title: JAX-RPC support changes
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_jax_rpc_support_changes
          tag:
          - rpc
          - jax-ws
          title: JAX-RPC specific configuration
          category-id: mandatory
          effort: 3
  - when:
      file:
      - filename: deployment-plan.xml
    perform:
      classification:
      - description:
        - This file should be removed and instead rely on proprietary functionality
          to automate deployments. Please consult EAP 7 admin documentation to learn
          about such functionality.
        link:
        - value: ""
          title: Migrate Deployment plan configurations
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_deployment_plan_configurations
        tag:
        - configuration
        title: JSR-88 deployment plans are no more supported by JBoss EAP7
        effort: 3
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='replication-trigger']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          deprecates `replication-trigger` element in `jboss-web.xml` file descriptor.\n
          \                   "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config replication-trigger changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='replication-mode']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          deprecates element `replication-mode` element without replacement in `jboss-web.xml`
          file descriptor.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config replication-mode changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='backups']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          deprecates `backups` element without replacement in `jboss-web.xml` file
          descriptor.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config backups changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='use-jk']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                         The EAP 7 Web Session Clustering configuration
          deprecates `use-jk` element without replacement in `jboss-web.xml` file
          descriptor.\n\n                         Previously by specifying `use-jk`
          element, the instance-id of the node handling a given request was appended
          to the jsessionid (foruse by load balancers such as mod_jk, mod_proxy_balancer,
          mod_cluster, etc.) depending on the value specified for `use-jk`.\n\n                         In
          the new implementation, the instance-id, if defined, is always appended
          to the jsessionid.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config use-jk changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='max-unreplicated-interval']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          deprecates `max-unreplicated-interval` element in `jboss-web.xml` file descriptor.\n\n
          \                      Previously, this configuration option was an optimization
          that would prevent the replication of a session’s timestamp if no session
          attribute was changed. While this sounds nice, in practice it doesn't prevent
          any RPCs, since session access requires cache transaction RPCs regardless
          of whether any session attributes changed.\n\n                       In
          the new implementation, the timestamp of a session is replicated on every
          request.\n                       This prevents stale session metadata following
          failover.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config max-unreplicated-interval changes in
          EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='snapshot-mode']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                     The EAP 7 Web Session Clustering configuration
          deprecates `snapshot-mode` element in `jboss-web.xml` file descriptor.\n\n
          \                    Previously, one could configure `snapshot-mode` as
          INSTANT or INTERVAL. Infinispan’s replication queue renders this configuration
          option obsolete.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config snapshot-mode changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='snapshot-interval']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          removed `snapshot-interval` element from `jboss-web.xml` file descriptor.\n
          \                      This option was only relevant for `<snapshot-mode>INTERVAL</snapshot-mode>`.
          Since `snapshot-mode` is no longer used, this option is no longer used as
          well.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config snapshot-interval changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='replication-config']/*[local-name()='session-notification-policy']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          deprecates `session-notification-policy` element in `jboss-web.xml` file
          descriptor.\n\n                       Previously `session-notification-policy`
          element defined a policy for triggering session events.\n\n                       In
          the new implementation, this behaviour is specification driven and not configurable.\n
          \                   "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config session-notification-policy changes in
          EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='passivation-config']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          deprecates `passivation-config` element and its sub-elements `use-session-passivation`,
          `passivation-min-idle-time` and `passivation-max-idle-time` completely in
          `jboss-web.xml` file descriptor.\n\n                       * `use-session-passivation`
          enabled the passivation, but now passivation is enabled by specifying a
          non-negative value for `max-active-sessions` element.\n\n                       *
          `passivation-min-idle-time` is not supported and the new implementation
          avoids waiting some time before the passivation.\n\n                       *
          `passivation-max-idle-time` is not supported and the new implementation
          supports only lazy passivation. Sessions are only passivated when necessary
          to comply with `max-active-sessions`.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config passivation-config changes in EAP 7
        category-id: optional
        effort: 1
  - when:
      xmlfile:
      - matches: /*[local-name()='jboss-web']/*[local-name()='max-active-sessions']
        in: jboss-web.xml
    perform:
      hint:
      - message: "\n                       The EAP 7 Web Session Clustering configuration
          changed `max-active-sessions` element meaning in `jboss-web.xml` file descriptor.\n\n
          \                      Previously, session creation would fail if an additional
          session would cause the number of active sessions to exceed the value specified
          by `<max-active-sessions/>`.\n\n                       In the new implementation,
          `<max-active-sessions/>` is used to enable session passivation. If session
          creation would cause the number of active sessions to exceed `<max-active-sessions/>`,\n
          then the oldest session known to the session manager will passivate to make
          room for the new session.\n                    "
        link:
        - value: ""
          title: Web Session Clustering config migration changes in EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/migration_guide/#migrate_web_session_clustering_changes
        tag:
        - cluster
        - web
        - configuration
        title: Web Session Clustering config max-active-sessions changes in EAP 7
        category-id: optional
        effort: 1
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/eap7/eap5and6/jboss-eap5and6to7-xml.windup.xml
