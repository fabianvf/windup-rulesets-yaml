metadata:
- description: "\n            This ruleset provides analysis of WebLogic proprietary
    XML descriptors and specific application parameters which needs to be replaced
    by some alternative configuration when migrating to JBoss EAP 7+.\n        "
  dependencies:
    addon:
    - id: org.jboss.windup.rules,windup-rules-javaee,2.7.0.Final
    - id: org.jboss.windup.rules,windup-rules-java,2.7.0.Final
    - id: org.jboss.windup.rules,windup-rules-xml,2.7.0.Final
  sourceTechnology:
  - id: weblogic
  targetTechnology:
  - id: eap
    versionRange: '[7,8)'
  tag:
  - weblogic
  - descriptor
  - configuration
rules:
  rule:
  - when:
      xmlfile:
      - matches: /*[local-name()='weblogic-application']
    perform:
      classification:
      - description:
        - "\n                      The `weblogic-application.xml` deployment descriptor
          file is used to describe Oracle WebLogic Server EAR archives. Oracle WebLogic
          Server EAR configures some application settings through the `application-param`
          element.\n                      These settings could be replaced with `context-param`
          elements in Java EE Servlet `web.xml` descriptor.\n                    "
        link:
        - value: ""
          title: 'Migrate Oracle WebLogic configuration files to JBoss EAP 6 or 7 '
          href: https://access.redhat.com/articles/1326803
        - value: ""
          title: Migrate Oracle WebLogic server descriptors (weblogic-application.xml)
            to JBoss EAP 6 or 7
          href: https://access.redhat.com/articles/1328043
        tag:
        - webservice
        - weblogic
        title: WebLogic EAR application descriptor (weblogic-application.xml)
        effort: 1
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: /*[local-name()='weblogic-rdbms-jar']
    perform:
      classification:
      - description:
        - WebLogic Entity EJB Configuration are used for RDBMS based persistence services.
        link:
        - value: ""
          title: Migrate Oracle WebLogic Server Configuration Files and Descriptors
            to JBoss EAP 6 or 7
          href: https://access.redhat.com/articles/1326803
        tag:
        - database
        - ejb
        - configuration
        - weblogic
        title: WebLogic Entity EJB configuration
        effort: 3
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: //*[local-name()='delay-updates-until-end-of-tx']/text()
    perform:
      hint:
      - message: "\n                      \n                      The WebLogic `<delay-updates-until-end-of-tx>`
          configuration element, which defaults to `true`, is used for performance
          reasons to delay updates to the persistent store of all beans until the
          end of the transaction. When set to `false`, updates are sent to the database
          after each method invocation, but are not committed until the end of the
          transaction. This allows other processes to access the persisted data while
          the transaction is waiting to be completed.\n\n                      In
          JBoss EAP 6+, you can achieve the same behavior by specifying the `<sync-on-commit-only>`
          in the jbosscmp-jdbc.xml file.\n                      \n                    "
        link:
        - value: ""
          title: Map delay-updates-until-end-of-tx element from weblogic-ejb-jar.xml
            Elements to the JBoss Enterprise Application Platform Equivalent
          href: https://access.redhat.com/articles/1326823
        tag:
        - performance
        - ejb
        - database
        - weblogic
        title: WebLogic EJB XML (weblogic-ejb-jar.xml) delay-updates-until-end-of-tx
        category-id: mandatory
        effort: 1
  - when:
      or:
      - xmlfile:
        - matches: /weblogic-ejb-jar
        - namespace:
          - value: ""
            prefix: wl9
            uri: http://www.bea.com/ns/weblogic/90
          matches: /wl9:weblogic-ejb-jar
        - namespace:
          - value: ""
            prefix: wl10
            uri: http://www.bea.com/ns/weblogic/10.0
          matches: /wl10:weblogic-ejb-jar
        - namespace:
          - value: ""
            prefix: wls
            uri: http://xmlns.oracle.com/weblogic/weblogic-ejb-jar
          matches: /wls:weblogic-ejb-jar
    perform:
      hint:
      - message: The elements of proprietary `weblogic-ejb-jar.xml` descriptor need
          to be mapped to the `jboss-ejb3.xml` one according to the attached knowledge
          article.
        link:
        - value: ""
          title: Migrate the weblogic-ejb-jar.xml
          href: https://access.redhat.com/articles/1326823
        tag:
        - ejb
        - configuration
        - weblogic
        title: WebLogic EJB XML (weblogic-ejb-jar.xml)
        category-id: mandatory
        effort: 3
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wl9
          uri: http://www.bea.com/ns/weblogic/90
        matches: //*[local-name() = 'allow-concurrent-calls' and translate(text(),'TRUE','true')
          = 'true' ]
    perform:
      hint:
      - message: |-
          Replace WebLogic proprietary configuration by Java EE annotation `@AccessTimeout`.
                            The equivalent usage is `@AccessTimeout(value= -1)`
        link:
        - value: ""
          title: Java EE 7 annotation @AccessTimeout
          href: http://docs.oracle.com/javaee/7/api/javax/ejb/AccessTimeout.html
        tag:
        - ejb
        - configuration
        - weblogic
        title: WebLogic Stateful Session Bean (SFSB)
        category-id: mandatory
        effort: 1
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wl10
          uri: http://www.bea.com/ns/weblogic/weblogic-wsee-standaloneclient
        matches: /weblogic-wsee-standaloneclient |/wl10:weblogic-wsee-standaloneclient
    perform:
      classification:
      - tag:
        - soap
        - weblogic
        title: WebLogic SOAP client mapping
        effort: 5
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: jee
          uri: http://java.sun.com/xml/ns/j2ee
        matches: /java-wsdl-mapping
    perform:
      classification:
      - tag:
        - wsdl
        - weblogic
        title: WebLogic Java to WSDL Mapping
        effort: 3
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wl9
          uri: http://www.bea.com/ns/weblogic/90
        - value: ""
          prefix: wl
          uri: http://www.bea.com/ns/weblogic/webservice-policy-ref
        matches: /webservice-policy-ref | /wl:webservice-policy-ref | /wl9:webservice-policy-ref
    perform:
      classification:
      - tag:
        - webservice
        - weblogic
        title: WebLogic web service policy
        effort: 5
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wl9
          uri: http://www.bea.com/ns/weblogic/90
        - value: ""
          prefix: wl
          uri: http://www.bea.com/ns/weblogic/weblogic-webservices
        as: webservices
        matches: /weblogic-webservices | /wl:weblogic-webservices | /wl9:weblogic-webservices
      - namespace:
        - value: ""
          prefix: wl9
          uri: http://www.bea.com/ns/weblogic/90
        - value: ""
          prefix: wl
          uri: http://www.bea.com/ns/weblogic/weblogic-webservices
        as: webservices-types
        matches: //webservice-type | //wl:webservice-type | //wl9:webservice-type
        from: webservices
    perform:
      iteration:
      - classification:
        - tag:
          - webservice
          - weblogic
          title: WebLogic web service descriptor
          effort: 3
          category-id: mandatory
          issue-display-mode: all
        over: webservices
      - hint:
        - message: "WebLogic webservices can be migrated to `jboss-webservices.xml`
            descriptor or to a Java EE standard Annotation based configuration. Reference
            the JBoss EAP product documentation for more information.\n                        "
          link:
          - value: ""
            title: Developing Web Services Guide
            href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/developing_web_services_applications/
          tag:
          - weblogic
          title: Webservice Type
          category-id: optional
          effort: 3
        over: webservices-types
  - when:
      xmlfile:
      - matches: /*[local-name()='weblogic-jms']
    perform:
      classification:
      - description:
        - "\n                        This file is a proprietary WebLogic JMS configuration
          and needs to be migrated.\n                        While there is no direct
          mapping of these descriptor elements, many of these features may be configured
          in the application deployment or JBoss server configuration files.\n\n                        For
          information on how to configure JBoss EAP JMS, please refer to the JBoss
          Enterprise Application Platform 7 messaging configuration documentation.\n
          \                   "
        link:
        - value: ""
          title: EAP 7 Overview of the Messaging subsystem configuration
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/configuring_messaging/#intro_messaging_config
        tag:
        - jms
        - configuration
        - weblogic
        title: WebLogic JMS descriptor
        effort: 3
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wlso
          uri: http://xmlns.oracle.com/weblogic/weblogic-web-app
        - value: ""
          prefix: bea
          uri: http://www.bea.com/ns/weblogic/90
        - value: ""
          prefix: wls
          uri: http://www.bea.com/ns/weblogic/weblogic-web-app
        matches: /bea:weblogic-web-app | /wlso:weblogic-web-app | /wls:weblogic-web-app
          | /weblogic-web-app
    perform:
      classification:
      - description:
        - "\n                        The Oracle WebLogic Server deployment descriptor
          file (`weblogic.xml`) provides functionality that is not included in the
          standard Java EE specification.\n                        While there is
          no direct mapping of these descriptor elements, many of these features may
          be configured in the application deployment or JBoss server configuration
          files.\n\n                        For more information on how to configure
          JBoss EAP, please refer to the Configuration Guide for JBoss Enterprise
          Application Platform 7.\n                    "
        link:
        - value: ""
          title: Migrate Oracle WebLogic configuration files to JBoss EAP
          href: https://access.redhat.com/articles/1326803
        - value: ""
          title: Map weblogic.xml configurations to JBoss EAP
          href: https://access.redhat.com/articles/1327803
        - value: ""
          title: Configuration Guide for JBoss EAP 7
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/configuration_guide/
        tag:
        - web-app
        - weblogic
        title: WebLogic web application descriptor (weblogic.xml)
        effort: 3
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - public-id: BEA.+RMI Runtime DTD 1..
    perform:
      classification:
      - tag:
        - weblogic
        title: WebLogic RMI XML version 1.x
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wsdd
          uri: http://www.bea.com/servers/wls70
        matches: /wsdd:type-mapping
    perform:
      classification:
      - tag:
        - webservice
        - weblogic
        title: WebLogic web service type mapping
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wlw
          uri: http://www.bea.com/2003/03/wlw/config/
        matches: /wlw:wlw-config
    perform:
      classification:
      - description:
        - WebLogic specific configuration of web services runtime parameters
        tag:
        - webservice
        - configuration
        - weblogic
        title: WebLogic services configuration
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - as: default
        matches: /project/taskdef[@classname='weblogic.ant.taskdefs.webservices.servicegen.ServiceGenTask']
          | /project/taskdef[@classname='weblogic.ant.taskdefs.webservices.javaschema.JavaSchema']
          | /project/taskdef[@classname='weblogic.ant.taskdefs.webservices.autotype.JavaSource2DD']
          | /project/taskdef[@classname='weblogic.ant.taskdefs.webservices.clientgen.ClientGenTask']
    perform:
      classification:
      - tag:
        - webservice
        - weblogic
        title: WebLogic specific webservice ant tasks
        effort: 13
        category-id: optional
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wl
          uri: http://www.bea.com/2004/03/wlw/external-config/
        matches: /wl:annotation-manifest | /annotation-manifest
    perform:
      classification:
      - description:
        - "\n                        In this file, the value set for a property by
          a metadata annotation can be overridden. (It does not override the values
          set by a setter method.)\n                    "
        tag:
        - configuration
        - weblogic
        title: WebLogic annotation manifest
        effort: 7
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - namespace:
        - value: ""
          prefix: wls
          uri: http://xmlns.oracle.com/weblogic/deployment-plan
        matches: /wls:deployment-plan
    perform:
      classification:
      - description:
        - "\n                        WebLogic `plan.xml` deployment descriptor file
          provides a way to target the application deployment for a specific environment.\n
          \                   "
        link:
        - value: ""
          title: Replace the WebLogic plan.xml deployment descriptor configuration
          href: https://access.redhat.com/articles/1329173
        tag:
        - configuration
        - weblogic
        title: WebLogic plan.xml deployment descriptor
        effort: 3
        category-id: mandatory
        issue-display-mode: all
  - when:
      xmlfile:
      - matches: //*[local-name()='trans-timeout-seconds']/text()
    perform:
      hint:
      - message: "\n                        \n                      The WebLogic `<trans-timeout-seconds>`
          configuration element sets the maximum duration for an EJB's container-initiated
          transactions, in seconds, after which the transaction is rolled back.  \n\n
          \                     In JBoss EAP 6+, you can achieve the same behavior
          by using the `TransactionTimeout` annotation.\n                      \n
          \                   "
        link:
        - value: ""
          title: WebLogic Server Deployment Elements
          href: https://docs.oracle.com/middleware/1221/wls/WLMDB/summary.htm#r35c1-t4
        - value: ""
          title: JBoss EAP 6 - Session Bean Transaction Timeout
          href: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/6.4/html-single/administration_and_configuration_guide/#Session_Bean_Transaction_Timeout
        - value: ""
          title: How to set EJB transaction timeout in JBoss EAP 6
          href: https://access.redhat.com/solutions/90553
        tag:
        - ejb
        - database
        - weblogic
        title: WebLogic EJB XML (weblogic-ejb-jar.xml) trans-timeout-seconds
        category-id: mandatory
        effort: 3
sourceFile: http://github.com/windup/windup-rulesets/tree/master/rules/rules-reviewed/eap7/weblogic/weblogic-xml-descriptors.windup.xml
